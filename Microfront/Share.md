#   微前端分享

[Micro Frontends](https://micro-frontends.org/)

##  概念 - 什么是微前端

    微前端是一种多个团队通过独立发布功能的方式来共同构建现代化 web 应用的技术手段及方法策略。
    
    类似于微服务的架构，它将微服务的理念应用于浏览器端，即将单页面前端应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立开发、独立部署。同时，它们也可以在共享组件的同时进行并行开发——这些组件可以通过 NPM 或者 Git Tag、Git Submodule 来管理。

##  意义 - 为什么需要微前端

微前端不是银弹，它和微服务一样会带来大量的挑战。

- 遗留系统迁移。解决遗留系统，才是人们采用微前端方案最重要的原因。

- 聚合前端应用。微服务架构，可以解耦后端服务间依赖。而微前端，则关注于聚合前端应用。

- 热闹驱动开发。新的技术，既然很热闹，那么就学吧。

        微前端的实现，意味着对前端应用的拆分。拆分应用的目的，并不只是为了架构上好看，还为了提升开发效率。

为此，微前端带来这么一系列的好处：

- 应用自治。只需要遵循统一的接口规范或者框架，以便于系统集成到一起，相互之间是不存在依赖关系的。

- 单一职责。每个前端应用可以只关注于自己所需要完成的功能。

- 技术栈无关。你可以使用 Angular 的同时，又可以使用 React 和 Vue。

除此，它也有一系列的缺点：

* 应用的拆分基础依赖于基础设施的构建，一旦大量应用依赖于同一基础设施，那么维护变成了一个挑战。
* 拆分的粒度越小，便意味着架构变得复杂、维护成本变高。
* 技术栈一旦多样化，便意味着技术栈混乱。

毕竟没有银弹。

##  原理 - 如何设计微前端架构？

要设计出一个微前端应用不是一件容易的事，每个项目所面临的情况、所使用的技术都不尽相同。为此，我们需要了解一些基础的微前端模式。

### 架构模式

微前端应用间的关系来看，分为两种：基座模式（管理式）、自组织式。分别也对应了两者不同的架构模式：

- 基座模式。通过一个主应用，来管理其它应用。设计难度小，方便实践，但是通用度低。

- 自组织模式。应用之间是平等的，不存在相互管理的模式。设计难度大，不方便实施，但是通用度高。
就当前而言，基座模式实施起来比较方便，方案上便也是蛮多的。

![](https://pics4.baidu.com/feed/8435e5dde71190ef74eaeb6de8a48b13fcfa60b6.jpeg?token=89882fd26b55635cc93b06c687dea820&s=BDA8583231CB614902D8DDDE000010A0)

而不论种方式，都需要提供一个查找应用的机制，在微前端中称为服务的注册表模式。和微服务架构相似，不论是哪种微前端方式，也都需要有一个应用注册表的服务，它可以是一个固定值的配置文件，如 JSON 文件，又或者是一个可动态更新的配置，又或者是一种动态的服务。它主要做这么一些内容：

* 应用发现。让主应用可以寻找到其它应用。
* 应用注册。即提供新的微前端应用，向应用注册表注册的功能。
* 第三方应用注册。即让第三方应用，可以接入到系统中。
* 访问权限等相关配置。

![](https://pics3.baidu.com/feed/6d81800a19d8bc3ef0c002a3a734b01baad345d6.jpeg?token=8216c783af71b7cbca5d063082e1f121&s=5AA8346219CFC4CA5E5D35CE0000E0B1)

应用在部署的时候，便可以在注册表服务中注册。如果是基于注册表来管理应用，那么使用基座模式来开发比较方便。

### 设计理念

在实践微前端的过程中，以下几点是我们在设计的过程中，需要关注的内容：

- 中心化：应用注册表。这个应用注册表拥有每个应用及对应的入口。在前端领域里，入口的直接表现形式可以是路由，又或者对应的应用映射。
- 标识化应用。我们需要一个标识符来标识不同的应用，以便于在安装、卸载的时候，能寻找到指定的应用。一个简单的模式，就是通过康威定律来命名应用。
- 应用生命周期管理。
- 高内聚，低耦合。

### 生命周期

前端微架构与后端微架构的最大不同之处，也在于此——生命周期。微前端应用作为一个客户端应用，每个应用都拥有自己的生命周期：

- Load，决定加载哪个应用，并绑定生命周期
- bootstrap，获取静态资源
- Mount，安装应用，如创建 DOM 节点
- Unload，删除应用的生命周期
- Unmount，卸载应用，如删除 DOM 节点、取消事件绑定

这部分的内容事实上，也就是微前端的一个难点所在，如何以合适的方式来加载应用——毕竟每个前端框架都各自不同，其所需要的加载方式也是不同的。当我们决定支持多个框架的时候，便需要在这一部分进入更细致的研究。

### 拆分应用技术方式

从技术实践上，微前端架构可以采用以下的几种方式进行：

- 路由分发式。通过 HTTP 服务器的反向代理功能，来将请求路由到对应的应用上。
- 前端微服务化。在不同的框架之上设计通讯、加载机制，以在一个页面内加载对应的应用。
- 微应用。通过软件工程的方式，在部署构建环境中，组合多个独立应用成一个单体应用。
- 微件化。开发一个新的构建系统，将部分业务功能构建成一个独立的 chunk 代码，使用时只需要远程加载即可。
- 前端容器化。通过将 iFrame 作为容器，来容纳其它前端应用。
- 应用组件化。借助于 Web Components 技术，来构建跨框架的前端应用。

实施的方式虽然多，但是都是依据场景而采用的。有些场景下，可能没有合适的方式；有些场景下，则可以同时使用多种方案。


##  ‌轮子 - 世面上有现成的轮子？如果有，它们是怎么实现的？

1. icestark

[Github](https://github.com/ice-lab/icestark)

特性
* 子应用支持 React/Vue/Angular... 等不同框架
* 框架应用只需依赖 npm 包 @ice/stark，不耦合任何工程体系
* 子应用独立开发、不耦合任何工程体系，已有应用迁移成本极低
* 整个系统用户体验好，跟 SPA 应用基本一致
* 子应用只需发布前端资源 bundle 即可，框架应用通过 bundle 渲染子应用

实现方式：

微件化。开发一个新的构建系统，将部分业务功能构建成一个独立的 chunk 代码，使用时只需要远程加载即可。

2. qiankun

[Github](https://github.com/umijs/qiankun)

3. single-spa

[Github](https://github.com/single-spa/single-spa)


##  选型 - 确定一种实现方案